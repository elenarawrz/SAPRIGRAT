package com.saprigrat.ui.forms.parcelas;

import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.LinkedList;

import com.saprigrat.data.Datos;
import com.saprigrat.data.Usuario;
import com.saprigrat.ui.interfaces.Formulario;
import com.vaadin.annotations.AutoGenerated;
import com.vaadin.data.Item;
import com.vaadin.data.Property.ValueChangeEvent;
import com.vaadin.data.Property.ValueChangeListener;
import com.vaadin.data.validator.RegexpValidator;
import com.vaadin.event.ItemClickEvent;
import com.vaadin.event.ItemClickEvent.ItemClickListener;
import com.vaadin.event.ShortcutAction.KeyCode;
import com.vaadin.event.ShortcutAction.ModifierKey;
import com.vaadin.shared.ui.combobox.FilteringMode;
import com.vaadin.shared.ui.datefield.Resolution;
import com.vaadin.ui.AbsoluteLayout;
import com.vaadin.ui.AbstractField;
import com.vaadin.ui.Alignment;
import com.vaadin.ui.Button;
import com.vaadin.ui.Button.ClickEvent;
import com.vaadin.ui.Button.ClickListener;
import com.vaadin.ui.ComboBox;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.DateField;
import com.vaadin.ui.HorizontalLayout;
import com.vaadin.ui.Label;
import com.vaadin.ui.Notification;
import com.vaadin.ui.Panel;
import com.vaadin.ui.Table;
import com.vaadin.ui.TextArea;
import com.vaadin.ui.TextField;
import com.vaadin.ui.VerticalLayout;

@SuppressWarnings("serial")
public class Riego extends CustomComponent implements Formulario
{
	/*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */

	@AutoGenerated
	private VerticalLayout mainLayout;
	@AutoGenerated
	private AbsoluteLayout absLBotones;
	@AutoGenerated
	private HorizontalLayout horLBotones;
	@AutoGenerated
	private Button btnVolver;
	@AutoGenerated
	private Button btnNuevo;
	@AutoGenerated
	private Button btnGuardar;
	@AutoGenerated
	private VerticalLayout verLDatos;
	@AutoGenerated
	private Panel panObservaciones;
	@AutoGenerated
	private AbsoluteLayout absLObservaciones;
	@AutoGenerated
	private TextArea txtObservaciones;
	@AutoGenerated
	private Table tblRiegos;
	@AutoGenerated
	private Panel panRiego;
	@AutoGenerated
	private VerticalLayout verLRiego;
	@AutoGenerated
	private AbsoluteLayout absLRiego3;
	@AutoGenerated
	private Label lblEficiencia;
	@AutoGenerated
	private TextField txtEficiencia;
	@AutoGenerated
	private Label lblLaminaCalc;
	@AutoGenerated
	private TextField txtLaminaCalc;
	@AutoGenerated
	private Label lblSuperficie;
	@AutoGenerated
	private TextField txtSuperficie;
	@AutoGenerated
	private Label lblGasto;
	@AutoGenerated
	private TextField txtGasto;
	@AutoGenerated
	private AbsoluteLayout absLRiego2;
	@AutoGenerated
	private DateField datFin;
	@AutoGenerated
	private DateField datInicio;
	@AutoGenerated
	private AbsoluteLayout absLRiego1;
	@AutoGenerated
	private ComboBox cmbEtapa;
	@AutoGenerated
	private TextField txtNoRiego;
	@AutoGenerated
	private HorizontalLayout horLDetallesBotones;
	@AutoGenerated
	private VerticalLayout verLBotones;
	@AutoGenerated
	private Button btnAdd;
	@AutoGenerated
	private Button btnCancelar;
	@AutoGenerated
	private Panel panDetalles;
	@AutoGenerated
	private AbsoluteLayout absLDetalles;
	@AutoGenerated
	private Label lblLaminaAnt;
	@AutoGenerated
	private TextField txtLaminaAnt;
	@AutoGenerated
	private ComboBox cmbTipoRiego;
	@AutoGenerated
	private ComboBox cmbParcela;
	@AutoGenerated
	private Table tblListado;
	@AutoGenerated
	private HorizontalLayout horLRespProd;
	@AutoGenerated
	private Panel panProductor;
	@AutoGenerated
	private AbsoluteLayout absLProductor;
	@AutoGenerated
	private ComboBox cmbProductor;
	@AutoGenerated
	private Panel panResponsable;
	@AutoGenerated
	private AbsoluteLayout absLResponsable;
	@AutoGenerated
	private ComboBox cmbResponsable;
	private Usuario usuario;
	private Datos datos;
	private String formatoFechaTbl, formatoFechaForm;
	private int idRiego;
	private LinkedList<LinkedList<Object>> listaRiego;
	
	private ClickListener agregarListener = new ClickListener()
											{
												@Override
												public void buttonClick(ClickEvent event)
												{
													if(validar())
													{
														LinkedList<Object> valores = llenarListaDeParametros();
														valores.add(0, cmbParcela.getValue());
														
														String status = datos.registrarRiego(valores);
														if(!status.isEmpty())
														{
															Notification.show("Registro añadido correctamente.", Notification.Type.TRAY_NOTIFICATION);
															//Se cambia a modo de modificación
															setTipo(MODO_MODIFICAR);
															idRiego = Integer.parseInt(status);
														}
														else
															Notification.show("Error al añadir registro, comuníquese con el administrador.", Notification.Type.ERROR_MESSAGE);
													}
												}
											};
	private ClickListener modificarListener =   new ClickListener()
												{
													@Override
													public void buttonClick(ClickEvent event)
													{
														if(validar())
														{
															LinkedList<Object> valores = llenarListaDeParametros();
															valores.add(0, idRiego);
															
															if(!datos.modificarRiego(valores).isEmpty())
																Notification.show("Registro modificado correctamente.", Notification.Type.TRAY_NOTIFICATION);
															else
																Notification.show("Error al modificar registro, comuníquese con el administrador.", Notification.Type.ERROR_MESSAGE);
														}
													}
												};
	private ItemClickListener llenarFormListener =  new ItemClickListener()
													{
														@Override
														public void itemClick(ItemClickEvent event)
														{
															if(event.isDoubleClick())
															{
																idRiego = (Integer)event.getItem().getItemProperty("ID").getValue();
																LinkedList<Object> valores = datos.getRiego(idRiego);
																if(!valores.isEmpty())
																{
																	setTipo(MODO_MODIFICAR);
																	
																	llenarLista(datos.getRespProductores(((String)cmbResponsable.getValue()).split(" ")[0]), cmbProductor);
																	cmbProductor.setValue(valores.remove());
																	llenarLista(datos.getCtasPadronParcelas(((String)cmbProductor.getValue()).split(" ")[0]), cmbParcela);
																	cmbParcela.setValue(valores.remove());
																	cmbTipoRiego.setValue(valores.remove());
																	txtLaminaAnt.setValue((String)valores.remove());
																	txtObservaciones.setValue((String)valores.remove());
																}
																else
																	Notification.show("Error al obtener el registro, comuníquese con el administrador.", Notification.Type.ERROR_MESSAGE);
															}
														}
													};
	private ValueChangeListener llenarTablaListener =   new ValueChangeListener()
														{
															@Override
															public void valueChange(ValueChangeEvent event)
															{
																tblListado.removeAllItems();
																//Obtener la lista
																LinkedList<Object[]> resultados = datos.getRiegos(((String)cmbResponsable.getValue()).split(" ")[0]);
																//Crear encabezados de columnas
																setHeaders((String[]) resultados.remove());
																//Llenar la lista o mostrar un mensaje dependiendo de si se encontraron elementos o no
																if(!resultados.isEmpty())
																	while(!resultados.isEmpty())
																		tblListado.addItem(resultados.remove(), null);
																else
																	Notification.show("No se encontró ningún resultado.", Notification.Type.HUMANIZED_MESSAGE);
																tblListado.setColumnCollapsed("ID",true);
															}
													
															private void setHeaders(String[] encabezado)
															{
																for(int i=0; i<encabezado.length; i++)
																	tblListado.addContainerProperty(encabezado[i], Object.class, null);
															}
														};
	private ClickListener showPanelListener=new ClickListener()
											{
												@Override
												public void buttonClick(ClickEvent event)
												{
													inicializarRiego();
												}

												private void inicializarRiego()
												{
													txtNoRiego.setValue((listaRiego.size() + 1) + "");
													cmbEtapa.select(null);
													datInicio.setValue(new java.util.Date());
													datFin.setValue(new java.util.Date());
													txtGasto.setValue("0");
													txtSuperficie.setValue("0");
													txtLaminaCalc.setValue("0");
													txtEficiencia.setValue("0");
													mostrarPanel(true);
													btnAdd.removeClickListener(showPanelListener);
													btnAdd.addClickListener(addRiegoListener);
												}
											};
	private ClickListener addRiegoListener =new ClickListener()
											{
												@Override
												public void buttonClick(ClickEvent event)
												{
													if(validarRiego())
													{
														listaRiego.add(getRiego());
														recargarListaRiego();
														mostrarPanel(false);
														btnAdd.removeClickListener(addRiegoListener);
														btnAdd.addClickListener(showPanelListener);
													}
												}
											};
	private ItemClickListener cargarRiegoListener = new ItemClickListener()
													{
														@Override
														public void itemClick(ItemClickEvent event)
														{
															if(event.isDoubleClick())
															{
																Item item = event.getItem();
																if(true)
																{
																	mostrarPanel(true);
																	txtNoRiego.setValue((Integer)item.getItemProperty("Núm.").getValue() + "");
																	datInicio.setValue(getFecha((String)item.getItemProperty("Fecha").getValue()));
																	cmbEtapa.setValue(item.getItemProperty("Etapa Fenológica").getValue());
																	datFin.setValue(getFecha((String)item.getItemProperty("FechaFin").getValue()));
																	txtGasto.setValue(item.getItemProperty("Gasto (L/s)").getValue() + "");
																	txtSuperficie.setValue(item.getItemProperty("Superficie Regada (ha)").getValue() + "");
																	txtLaminaCalc.setValue(item.getItemProperty("Lámina Calculada (cm)").getValue() + "");
																	txtEficiencia.setValue(item.getItemProperty("Eficiencia").getValue() + "");
																	
																	btnAdd.setCaption("Guardar Cambios");
																	btnAdd.removeClickListener(showPanelListener);
																	btnAdd.addClickListener(modificarRiegoListener);
																}
																else
																	Notification.show("Error al obtener el registro, comuníquese con el administrador.", Notification.Type.ERROR_MESSAGE);
															}
														}
														
														private java.util.Date getFecha(String fechaStr)
														{
															try
															{
																return new SimpleDateFormat(formatoFechaTbl).parse(fechaStr);
															}
															catch (ParseException e) { return null; }
														}
													};
	private ClickListener modificarRiegoListener =  new ClickListener()
													{
														@Override
														public void buttonClick(ClickEvent event)
														{
															if(validarRiego())
															{
																listaRiego.set(Integer.parseInt(txtNoRiego.getValue()) - 1, getRiego());
																recargarListaRiego();
																mostrarPanel(false);
																
																btnAdd.setCaption("Agregar Riego");
																btnAdd.removeClickListener(modificarRiegoListener);
																btnAdd.addClickListener(showPanelListener);
															}
														}
													};
	private ClickListener nuevoListener =   new ClickListener()
											{
												@Override
												public void buttonClick(ClickEvent event)
												{
													inicializar();
													setTipo(MODO_AGREGAR);
												}
											};
	private ClickListener listadoListener = new ClickListener()
											{
												@Override
												public void buttonClick(ClickEvent event)
												{
													inicializar();
													setTipo(MODO_LISTA);
												}
											};
	private ClickListener cancelarListener =new ClickListener()
											{
												@Override
												public void buttonClick(ClickEvent event)
												{
													mostrarPanel(false);
													btnAdd.setCaption("Agregar Riego");
													btnAdd.removeClickListener(addRiegoListener);
													btnAdd.removeClickListener(modificarRiegoListener);
													btnAdd.addClickListener(showPanelListener);
												}
											};
	private ValueChangeListener llenarProdsListener=new ValueChangeListener()
													{
														@Override
														public void valueChange(ValueChangeEvent event)
														{
															cmbParcela.removeAllItems();
															cmbProductor.removeValueChangeListener(llenarParcelasListener);
															llenarLista(datos.getRespProductores(((String)cmbResponsable.getValue()).split(" ")[0]), cmbProductor);
															if(cmbProductor.size() != 0)
																cmbProductor.addValueChangeListener(llenarParcelasListener);
															else
																Notification.show("No se podrá agregar el registro ya que este técnico no tiene asignado a ningún productor.", Notification.Type.ERROR_MESSAGE);
														}
													};
	private ValueChangeListener llenarParcelasListener =new ValueChangeListener()
														{
															@Override
															public void valueChange(ValueChangeEvent event)
															{
																llenarLista(datos.getCtasPadronParcelas(((String)cmbProductor.getValue()).split(" ")[0]), cmbParcela);
																if(cmbParcela.size() == 0)
																	Notification.show("No se podrá agregar el registro ya que este productor no está relacionado con ninguna parcela.", Notification.Type.ERROR_MESSAGE);
															}
														};
	
	public Riego(Usuario user)
	{
		formatoFechaTbl = "dd-MM-yyyy, hh:mm a";
		formatoFechaForm = "dd - MMM - yyyy, hh:mm a";
		listaRiego = new LinkedList<LinkedList<Object>>();
		usuario = user;
		//inicializar();
	}

	@Override
	public void inicializar()
	{
		buildMainLayout();
		setCompositionRoot(mainLayout);

		//Variables
		datos = new Datos();
		//Textos
		txtNoRiego.setEnabled(false);
		//Combos
		setupCombo(cmbResponsable);
		setupCombo(cmbProductor);
		cmbProductor.addValueChangeListener(llenarParcelasListener);
		cmbParcela.setNullSelectionAllowed(false);
		cmbParcela.setInputPrompt("Busque por numero de cuenta de padrón.");
		cmbTipoRiego.setNullSelectionAllowed(false);
		llenarLista(datos.getTipoRiego(), cmbTipoRiego);
		cmbEtapa.setNullSelectionAllowed(false);
		llenarLista(datos.getEtapaFenologica(), cmbEtapa);
		//Calendarios
		setCalendario(datInicio);
		setCalendario(datFin);
		//Botones
		btnAdd.addClickListener(showPanelListener);
		btnCancelar.addClickListener(cancelarListener);
		btnNuevo.addClickListener(nuevoListener);
		btnVolver.addClickListener(listadoListener);
		//Tablas
		tblListado.setSelectable(true);
		tblListado.setSortEnabled(true);
		tblListado.setColumnCollapsingAllowed(true);
		tblListado.addItemClickListener(llenarFormListener);
//		tblRiegos.setRowHeaderMode(Table.RowHeaderMode.INDEX);
		tblRiegos.addContainerProperty("Núm.", Object.class, null);
		tblRiegos.addContainerProperty("Fecha", Object.class, null);
		tblRiegos.addContainerProperty("FechaFin", Object.class, null);
		tblRiegos.addContainerProperty("Etapa Fenológica", Object.class, null);
		tblRiegos.addContainerProperty("Gasto (L/s)", Object.class, null);
		tblRiegos.addContainerProperty("Tiempo (h)", Object.class, null);
		tblRiegos.addContainerProperty("Volúmen (m3)", Object.class, null);
		tblRiegos.addContainerProperty("Superficie Regada (ha)", Object.class, null);
		tblRiegos.addContainerProperty("Lámina Aplicada (cm)", Object.class, null);
		tblRiegos.addContainerProperty("Lámina Calculada (cm)", Object.class, null);
		tblRiegos.addContainerProperty("Eficiencia", Object.class, null);
		tblRiegos.setSelectable(true);
		tblRiegos.setSortEnabled(true);
		tblRiegos.setColumnCollapsingAllowed(true);
		tblRiegos.setColumnCollapsed("FechaFin", true);
		tblRiegos.addItemClickListener(cargarRiegoListener);
		
		//Inicializar en modo lista
		setTipo(MODO_LISTA);
		//Agregar las validaciones necesarias
		setValidaciones();
	}

	@Override
	public void setTipo(int modoOperacion)
	{
		btnNuevo.setClickShortcut(KeyCode.N, ModifierKey.ALT);
		if(modoOperacion == MODO_LISTA)
		{
			cmbResponsable.addValueChangeListener(llenarTablaListener);
			cmbResponsable.removeValueChangeListener(llenarProdsListener);
			setResponsableTecnico(usuario.getTipo());
			mostrarTabla(true);
			btnGuardar.removeClickShortcut();
			btnGuardar.setVisible(false);
			btnVolver.removeClickShortcut();
			btnVolver.setVisible(false);
			btnNuevo.setCaption("Agregar Nuevo");
		}
		else
		{
			cmbResponsable.removeValueChangeListener(llenarTablaListener);
			cmbResponsable.addValueChangeListener(llenarProdsListener);
			mostrarTabla(false);
			mostrarPanel(false);
			btnGuardar.setClickShortcut(KeyCode.G, ModifierKey.ALT);
			btnGuardar.setVisible(true);
			btnVolver.setClickShortcut(KeyCode.V, ModifierKey.ALT);
			btnVolver.setVisible(true);
			
			if(modoOperacion == MODO_AGREGAR)
			{
				elementosIdHabilitados(true);
				btnGuardar.removeClickListener(modificarListener);
				btnGuardar.addClickListener(agregarListener);
				btnGuardar.setCaption("Guardar");
				btnNuevo.setClickShortcut(KeyCode.L, ModifierKey.ALT);
				btnNuevo.setCaption("Limpiar");
			}
			else
			{
				elementosIdHabilitados(false);
				btnGuardar.removeClickListener(agregarListener);
				btnGuardar.addClickListener(modificarListener);
				btnGuardar.setCaption("Guardar cambios");
				btnNuevo.setCaption("Agregar Nuevo");
			}
		}
	}

	private void setResponsableTecnico(int tipoAgregando)
	{
		if(tipoAgregando == usuario.RESPONSABLE)
		{
			String item = usuario.getCURR() + " " + usuario.getNombre() + " " +
						  usuario.getApPaterno() + " " + usuario.getApMaterno();
			cmbResponsable.addItem(item);
			cmbResponsable.select(item);
			cmbResponsable.setEnabled(false);
		}
		else
		{
			llenarLista(datos.getRespTecnicos(usuario.getCURR(), tipoAgregando, usuario.RESPONSABLE), cmbResponsable);
			if(cmbResponsable.size() == 0)
			{
				mainLayout.removeAllComponents();
				Notification.show("Imposible registrar. Se requiere que exista en la base de datos al menos un productor a quien pueda ser asignada esta parcela.", Notification.Type.ERROR_MESSAGE);
			}
		}
	}

	private void mostrarTabla(boolean estado)
	{
		panProductor.setVisible(!estado);
		tblListado.setVisible(estado);
		verLDatos.setVisible(!estado);
	}
	
	private void mostrarPanel(boolean estado)
	{
		panRiego.setVisible(estado);
		btnCancelar.setVisible(estado);
	}
	
	private void elementosIdHabilitados(boolean habilitado)
	{
		cmbResponsable.setEnabled(habilitado);
		cmbProductor.setEnabled(habilitado);
		cmbParcela.setEnabled(habilitado);
	}

	private void setCalendario(DateField cal)
	{
		cal.setResolution(Resolution.MINUTE);
		cal.setValue(new java.util.Date());
		cal.setDateFormat(formatoFechaForm);
	}

	private void setValidaciones()
	{
		RegexpValidator esDecimal = new RegexpValidator("^[0-9]+(\\.[0-9]+)?$",
														"Debe ser un valor numérico");
		txtLaminaAnt.addValidator(esDecimal);
		txtGasto.addValidator(esDecimal);
		txtSuperficie.addValidator(esDecimal);
		txtLaminaCalc.addValidator(esDecimal);
		txtEficiencia.addValidator(esDecimal);
	}
	
	private boolean validar()
	{
		if(cmbResponsable.getValue() == null)
			return notificar("Se requiere especificar el responsable técnico", cmbResponsable);
		if(cmbProductor.getValue() == null)
			return notificar("Se requiere especificar el usuario/productor", cmbProductor);
		if(cmbParcela.getValue() == null)
			return notificar("Se requiere especificar la parcela a la que se aplica el riego", cmbParcela);

		if(cmbTipoRiego.getValue() == null)
			return notificar("Se requiere especificar el tipo de riego", cmbTipoRiego);

		if(txtLaminaAnt.getValue().isEmpty() || !txtLaminaAnt.isValid())
			return notificar("Se requiere especificar un valor estríctamente numérico para la lámina del ciclo anterior", txtLaminaAnt);
		return true;
	}
	
	private boolean validarRiego()
	{
		if(cmbEtapa.getValue() == null)
			return notificar("Se requiere especificar la etapa fenológica", cmbEtapa);

		if(datInicio.getValue() == null)
			return notificar("Se requiere especificar la fecha y hora de inicio", datInicio);
		if(datFin.getValue() == null)
			return notificar("Se requiere especificar la fecha y hora de fin", datFin);
		
		if(txtGasto.getValue().isEmpty() || !txtGasto.isValid())
			return notificar("Se requiere especificar un valor estríctamente numérico para el gasto", txtGasto);
		if(txtSuperficie.getValue().isEmpty() || !txtSuperficie.isValid())
			return notificar("Se requiere especificar un valor estríctamente numérico para la superficie", txtSuperficie);
		if(txtLaminaCalc.getValue().isEmpty() || !txtLaminaCalc.isValid())
			return notificar("Se requiere especificar un valor estríctamente numérico para la lámina calculada", txtLaminaCalc);
		if(txtEficiencia.getValue().isEmpty() || !txtEficiencia.isValid())
			return notificar("Se requiere especificar un valor estríctamente numérico para la eficiencia", txtEficiencia);
		
		return true;
	}
	
	@SuppressWarnings("rawtypes")
	private boolean notificar(String notificacion, AbstractField field)
	{
		Notification.show(notificacion, Notification.Type.ERROR_MESSAGE);
		field.focus();
		return false;
	}

	private LinkedList<Object> llenarListaDeParametros()
	{
		LinkedList<Object> valores = new LinkedList<Object>();
		valores.add(cmbTipoRiego.getValue());
		valores.add(Double.parseDouble(txtLaminaAnt.getValue()));
		valores.add(txtObservaciones.getValue());
		return valores;
	}
	
	private void llenarLista(LinkedList<String>elementos, ComboBox cmb)
	{
		cmb.removeAllItems();
		for(String elemento : elementos)
			cmb.addItem(elemento);
	}

	private void setupCombo(ComboBox cmb)
	{
		cmb.setNullSelectionAllowed(false);
		cmb.setFilteringMode(FilteringMode.CONTAINS);
		cmb.setInputPrompt("Busque por nombre o CURR.");
	}
	
	private LinkedList<Object> getRiego()
	{
		double gasto = Double.parseDouble(txtGasto.getValue());
		int tiempo = (int)((datFin.getValue().getTime() - datInicio.getValue().getTime()) / 3600000);
		double volumen = gasto * tiempo * 3600000; //Gasto[L/s]*3600:[L/h] -> Gasto[L/h]*Tiempo[h]:[L] -> [L]*1000 = Volumen[m3]
		double superficie = Double.parseDouble(txtSuperficie.getValue());
		double laminaApl = volumen / superficie * 1000000; //Superficie[ha]*10000:[m2] -> Volumen[m3]/Superficie[m2]:[m] -> [m]*100 = LaminaApl[cm]
		
		LinkedList<Object> row = new LinkedList<Object>();
		row.add(0);
		row.add(new SimpleDateFormat(formatoFechaTbl).format(datInicio.getValue()));
		row.add(new SimpleDateFormat(formatoFechaTbl).format(datFin.getValue()));
		row.add(cmbEtapa.getValue());
		row.add(gasto);
		row.add(tiempo);
		row.add(volumen);
		row.add(superficie);
		row.add(laminaApl);
		row.add(Double.parseDouble(txtLaminaCalc.getValue()));
		row.add(txtEficiencia.getValue());
		
		return row;
	}
	
	private void recargarListaRiego()
	{
		tblRiegos.removeAllItems();
		for(int i = 0; i < listaRiego.size(); i++)
		{
			LinkedList<Object> riego = listaRiego.get(i);
			riego.set(0, i + 1);
			tblRiegos.addItem(riego.toArray(), null);
		}
	}
	//region UI
	
	@AutoGenerated
	private VerticalLayout buildMainLayout() {
		// common part: create layout
		mainLayout = new VerticalLayout();
		mainLayout.setImmediate(false);
		mainLayout.setWidth("-1px");
		mainLayout.setHeight("-1px");
		mainLayout.setMargin(true);
		mainLayout.setSpacing(true);
		
		// top-level component properties
		setWidth("-1px");
		setHeight("-1px");
		
		// horLRespProd
		horLRespProd = buildHorLRespProd();
		mainLayout.addComponent(horLRespProd);
		
		// tblListado
		tblListado = new Table();
		tblListado
				.setCaption("* Dar doble click sobre un elemento para modificarlo");
		tblListado.setImmediate(false);
		tblListado.setWidth("601px");
		tblListado.setHeight("300px");
		mainLayout.addComponent(tblListado);
		
		// verLDatos
		verLDatos = buildVerLDatos();
		mainLayout.addComponent(verLDatos);
		
		// absLBotones
		absLBotones = buildAbsLBotones();
		mainLayout.addComponent(absLBotones);
		
		return mainLayout;
	}

	@AutoGenerated
	private HorizontalLayout buildHorLRespProd() {
		// common part: create layout
		horLRespProd = new HorizontalLayout();
		horLRespProd.setImmediate(false);
		horLRespProd.setWidth("601px");
		horLRespProd.setHeight("-1px");
		horLRespProd.setMargin(false);
		
		// panResponsable
		panResponsable = buildPanResponsable();
		horLRespProd.addComponent(panResponsable);
		
		// panProductor
		panProductor = buildPanProductor();
		horLRespProd.addComponent(panProductor);
		horLRespProd.setComponentAlignment(panProductor, new Alignment(6));
		
		return horLRespProd;
	}

	@AutoGenerated
	private Panel buildPanResponsable() {
		// common part: create layout
		panResponsable = new Panel();
		panResponsable.setCaption("Responsable Técnico");
		panResponsable.setImmediate(false);
		panResponsable.setWidth("296px");
		panResponsable.setHeight("-1px");
		
		// absLResponsable
		absLResponsable = buildAbsLResponsable();
		panResponsable.setContent(absLResponsable);
		
		return panResponsable;
	}

	@AutoGenerated
	private AbsoluteLayout buildAbsLResponsable() {
		// common part: create layout
		absLResponsable = new AbsoluteLayout();
		absLResponsable.setImmediate(false);
		absLResponsable.setWidth("100.0%");
		absLResponsable.setHeight("45px");
		
		// cmbResponsable
		cmbResponsable = new ComboBox();
		cmbResponsable.setImmediate(true);
		cmbResponsable.setWidth("275px");
		cmbResponsable.setHeight("25px");
		absLResponsable.addComponent(cmbResponsable, "top:10.0px;left:10.0px;");
		
		return absLResponsable;
	}

	@AutoGenerated
	private Panel buildPanProductor() {
		// common part: create layout
		panProductor = new Panel();
		panProductor.setCaption("Usuario/Productor");
		panProductor.setImmediate(false);
		panProductor.setWidth("296px");
		panProductor.setHeight("-1px");
		
		// absLProductor
		absLProductor = buildAbsLProductor();
		panProductor.setContent(absLProductor);
		
		return panProductor;
	}

	@AutoGenerated
	private AbsoluteLayout buildAbsLProductor() {
		// common part: create layout
		absLProductor = new AbsoluteLayout();
		absLProductor.setImmediate(false);
		absLProductor.setWidth("100.0%");
		absLProductor.setHeight("45px");
		
		// cmbProductor
		cmbProductor = new ComboBox();
		cmbProductor.setImmediate(true);
		cmbProductor.setWidth("275px");
		cmbProductor.setHeight("25px");
		absLProductor.addComponent(cmbProductor, "top:10.0px;left:10.0px;");
		
		return absLProductor;
	}

	@AutoGenerated
	private VerticalLayout buildVerLDatos() {
		// common part: create layout
		verLDatos = new VerticalLayout();
		verLDatos.setImmediate(false);
		verLDatos.setWidth("-1px");
		verLDatos.setHeight("-1px");
		verLDatos.setMargin(false);
		verLDatos.setSpacing(true);
		
		// horLDetallesBotones
		horLDetallesBotones = buildHorLDetallesBotones();
		verLDatos.addComponent(horLDetallesBotones);
		
		// panRiego
		panRiego = buildPanRiego();
		verLDatos.addComponent(panRiego);
		
		// tblRiegos
		tblRiegos = new Table();
		tblRiegos
				.setCaption("* Dar doble click sobre un elemento para modificarlo");
		tblRiegos.setImmediate(false);
		tblRiegos.setWidth("601px");
		tblRiegos.setHeight("200px");
		verLDatos.addComponent(tblRiegos);
		
		// panObservaciones
		panObservaciones = buildPanObservaciones();
		verLDatos.addComponent(panObservaciones);
		
		return verLDatos;
	}

	@AutoGenerated
	private HorizontalLayout buildHorLDetallesBotones() {
		// common part: create layout
		horLDetallesBotones = new HorizontalLayout();
		horLDetallesBotones.setImmediate(false);
		horLDetallesBotones.setWidth("601px");
		horLDetallesBotones.setHeight("-1px");
		horLDetallesBotones.setMargin(false);
		
		// panDetalles
		panDetalles = buildPanDetalles();
		horLDetallesBotones.addComponent(panDetalles);
		
		// verLBotones
		verLBotones = buildVerLBotones();
		horLDetallesBotones.addComponent(verLBotones);
		horLDetallesBotones.setComponentAlignment(verLBotones,
				new Alignment(10));
		
		return horLDetallesBotones;
	}

	@AutoGenerated
	private Panel buildPanDetalles() {
		// common part: create layout
		panDetalles = new Panel();
		panDetalles.setCaption("Detalles del Riego");
		panDetalles.setImmediate(false);
		panDetalles.setWidth("401px");
		panDetalles.setHeight("-1px");
		
		// absLDetalles
		absLDetalles = buildAbsLDetalles();
		panDetalles.setContent(absLDetalles);
		
		return panDetalles;
	}

	@AutoGenerated
	private AbsoluteLayout buildAbsLDetalles() {
		// common part: create layout
		absLDetalles = new AbsoluteLayout();
		absLDetalles.setImmediate(false);
		absLDetalles.setWidth("100.0%");
		absLDetalles.setHeight("110px");
		
		// cmbParcela
		cmbParcela = new ComboBox();
		cmbParcela
				.setCaption("Parcela (Cta. / Subcta. de Padrón, Fecha de Siembra)");
		cmbParcela.setImmediate(true);
		cmbParcela.setWidth("380px");
		cmbParcela.setHeight("25px");
		absLDetalles.addComponent(cmbParcela, "top:28.0px;left:10.0px;");
		
		// cmbTipoRiego
		cmbTipoRiego = new ComboBox();
		cmbTipoRiego.setCaption("Tipo de Riego");
		cmbTipoRiego.setImmediate(false);
		cmbTipoRiego.setWidth("220px");
		cmbTipoRiego.setHeight("25px");
		absLDetalles.addComponent(cmbTipoRiego, "top:71.0px;left:10.0px;");
		
		// txtLaminaAnt
		txtLaminaAnt = new TextField();
		txtLaminaAnt.setCaption("Lamina del Ciclo Anterior");
		txtLaminaAnt.setImmediate(true);
		txtLaminaAnt.setWidth("120px");
		txtLaminaAnt.setHeight("25px");
		txtLaminaAnt.setInvalidAllowed(false);
		absLDetalles.addComponent(txtLaminaAnt, "top:73.0px;left:250.0px;");
		
		// lblLaminaAnt
		lblLaminaAnt = new Label();
		lblLaminaAnt.setImmediate(false);
		lblLaminaAnt.setWidth("-1px");
		lblLaminaAnt.setHeight("-1px");
		lblLaminaAnt.setValue("ha");
		absLDetalles.addComponent(lblLaminaAnt, "top:77.0px;left:375.0px;");
		
		return absLDetalles;
	}

	@AutoGenerated
	private VerticalLayout buildVerLBotones() {
		// common part: create layout
		verLBotones = new VerticalLayout();
		verLBotones.setImmediate(false);
		verLBotones.setWidth("-1px");
		verLBotones.setHeight("-1px");
		verLBotones.setMargin(false);
		verLBotones.setSpacing(true);
		
		// btnCancelar
		btnCancelar = new Button();
		btnCancelar.setCaption("Cancelar");
		btnCancelar.setImmediate(true);
		btnCancelar.setWidth("130px");
		btnCancelar.setHeight("-1px");
		verLBotones.addComponent(btnCancelar);
		verLBotones.setComponentAlignment(btnCancelar, new Alignment(6));
		
		// btnAdd
		btnAdd = new Button();
		btnAdd.setCaption("Agregar Riego");
		btnAdd.setImmediate(true);
		btnAdd.setWidth("130px");
		btnAdd.setHeight("-1px");
		verLBotones.addComponent(btnAdd);
		verLBotones.setComponentAlignment(btnAdd, new Alignment(6));
		
		return verLBotones;
	}

	@AutoGenerated
	private Panel buildPanRiego() {
		// common part: create layout
		panRiego = new Panel();
		panRiego.setImmediate(false);
		panRiego.setWidth("601px");
		panRiego.setHeight("-1px");
		
		// verLRiego
		verLRiego = buildVerLRiego();
		panRiego.setContent(verLRiego);
		
		return panRiego;
	}

	@AutoGenerated
	private VerticalLayout buildVerLRiego() {
		// common part: create layout
		verLRiego = new VerticalLayout();
		verLRiego.setImmediate(false);
		verLRiego.setWidth("100.0%");
		verLRiego.setHeight("-1px");
		verLRiego.setMargin(false);
		
		// absLRiego1
		absLRiego1 = buildAbsLRiego1();
		verLRiego.addComponent(absLRiego1);
		
		// absLRiego2
		absLRiego2 = buildAbsLRiego2();
		verLRiego.addComponent(absLRiego2);
		
		// absLRiego3
		absLRiego3 = buildAbsLRiego3();
		verLRiego.addComponent(absLRiego3);
		
		return verLRiego;
	}

	@AutoGenerated
	private AbsoluteLayout buildAbsLRiego1() {
		// common part: create layout
		absLRiego1 = new AbsoluteLayout();
		absLRiego1.setImmediate(false);
		absLRiego1.setWidth("100.0%");
		absLRiego1.setHeight("55px");
		
		// txtNoRiego
		txtNoRiego = new TextField();
		txtNoRiego.setCaption("Núm. de Riego");
		txtNoRiego.setImmediate(false);
		txtNoRiego.setWidth("100px");
		txtNoRiego.setHeight("25px");
		absLRiego1.addComponent(txtNoRiego, "top:28.0px;left:10.0px;");
		
		// cmbEtapa
		cmbEtapa = new ComboBox();
		cmbEtapa.setCaption("Etapa Fenológica");
		cmbEtapa.setImmediate(true);
		cmbEtapa.setWidth("280px");
		cmbEtapa.setHeight("25px");
		absLRiego1.addComponent(cmbEtapa, "top:28.0px;left:130.0px;");
		
		return absLRiego1;
	}

	@AutoGenerated
	private AbsoluteLayout buildAbsLRiego2() {
		// common part: create layout
		absLRiego2 = new AbsoluteLayout();
		absLRiego2.setImmediate(false);
		absLRiego2.setWidth("100.0%");
		absLRiego2.setHeight("45px");
		
		// datInicio
		datInicio = new DateField();
		datInicio.setCaption("Fecha de Inicio");
		datInicio.setImmediate(false);
		datInicio.setWidth("280px");
		datInicio.setHeight("25px");
		absLRiego2.addComponent(datInicio, "top:18.0px;left:10.0px;");
		
		// datFin
		datFin = new DateField();
		datFin.setCaption("Fecha de Fin");
		datFin.setImmediate(false);
		datFin.setWidth("280px");
		datFin.setHeight("25px");
		absLRiego2.addComponent(datFin, "top:18.0px;left:310.0px;");
		
		return absLRiego2;
	}

	@AutoGenerated
	private AbsoluteLayout buildAbsLRiego3() {
		// common part: create layout
		absLRiego3 = new AbsoluteLayout();
		absLRiego3.setImmediate(false);
		absLRiego3.setWidth("100.0%");
		absLRiego3.setHeight("55px");
		
		// txtGasto
		txtGasto = new TextField();
		txtGasto.setCaption("Gasto");
		txtGasto.setImmediate(true);
		txtGasto.setWidth("110px");
		txtGasto.setHeight("25px");
		absLRiego3.addComponent(txtGasto, "top:18.0px;left:10.0px;");
		
		// lblGasto
		lblGasto = new Label();
		lblGasto.setImmediate(false);
		lblGasto.setWidth("-1px");
		lblGasto.setHeight("-1px");
		lblGasto.setValue("L/s");
		absLRiego3.addComponent(lblGasto, "top:22.0px;left:125.0px;");
		
		// txtSuperficie
		txtSuperficie = new TextField();
		txtSuperficie.setCaption("Superficie Regada");
		txtSuperficie.setImmediate(true);
		txtSuperficie.setWidth("110px");
		txtSuperficie.setHeight("25px");
		absLRiego3.addComponent(txtSuperficie, "top:18.0px;left:160.0px;");
		
		// lblSuperficie
		lblSuperficie = new Label();
		lblSuperficie.setImmediate(false);
		lblSuperficie.setWidth("-1px");
		lblSuperficie.setHeight("-1px");
		lblSuperficie.setValue("ha");
		absLRiego3.addComponent(lblSuperficie, "top:22.0px;left:275.0px;");
		
		// txtLaminaCalc
		txtLaminaCalc = new TextField();
		txtLaminaCalc.setCaption("Lamina Calculada");
		txtLaminaCalc.setImmediate(true);
		txtLaminaCalc.setWidth("110px");
		txtLaminaCalc.setHeight("25px");
		absLRiego3.addComponent(txtLaminaCalc, "top:18.0px;left:310.0px;");
		
		// lblLaminaCalc
		lblLaminaCalc = new Label();
		lblLaminaCalc.setImmediate(false);
		lblLaminaCalc.setWidth("-1px");
		lblLaminaCalc.setHeight("-1px");
		lblLaminaCalc.setValue("cm");
		absLRiego3.addComponent(lblLaminaCalc, "top:22.0px;left:425.0px;");
		
		// txtEficiencia
		txtEficiencia = new TextField();
		txtEficiencia.setCaption("Eficiencia Parcelaria");
		txtEficiencia.setImmediate(true);
		txtEficiencia.setWidth("110px");
		txtEficiencia.setHeight("25px");
		absLRiego3.addComponent(txtEficiencia, "top:18.0px;left:460.0px;");
		
		// lblEficiencia
		lblEficiencia = new Label();
		lblEficiencia.setImmediate(false);
		lblEficiencia.setWidth("-1px");
		lblEficiencia.setHeight("-1px");
		lblEficiencia.setValue("?");
		absLRiego3.addComponent(lblEficiencia, "top:22.0px;left:575.0px;");
		
		return absLRiego3;
	}

	@AutoGenerated
	private Panel buildPanObservaciones() {
		// common part: create layout
		panObservaciones = new Panel();
		panObservaciones.setCaption("Observaciones");
		panObservaciones.setImmediate(false);
		panObservaciones.setWidth("601px");
		panObservaciones.setHeight("-1px");
		
		// absLObservaciones
		absLObservaciones = buildAbsLObservaciones();
		panObservaciones.setContent(absLObservaciones);
		
		return panObservaciones;
	}

	@AutoGenerated
	private AbsoluteLayout buildAbsLObservaciones() {
		// common part: create layout
		absLObservaciones = new AbsoluteLayout();
		absLObservaciones.setImmediate(false);
		absLObservaciones.setWidth("100.0%");
		absLObservaciones.setHeight("120px");
		
		// txtObservaciones
		txtObservaciones = new TextArea();
		txtObservaciones.setImmediate(false);
		txtObservaciones.setWidth("580px");
		txtObservaciones.setHeight("100px");
		absLObservaciones.addComponent(txtObservaciones,
				"top:10.0px;left:10.0px;");
		
		return absLObservaciones;
	}

	@AutoGenerated
	private AbsoluteLayout buildAbsLBotones() {
		// common part: create layout
		absLBotones = new AbsoluteLayout();
		absLBotones.setImmediate(false);
		absLBotones.setWidth("601px");
		absLBotones.setHeight("30px");
		
		// btnGuardar
		btnGuardar = new Button();
		btnGuardar.setCaption("Guardar");
		btnGuardar.setImmediate(true);
		btnGuardar.setWidth("-1px");
		btnGuardar.setHeight("-1px");
		absLBotones.addComponent(btnGuardar, "right:0.0px;bottom:0.0px;");
		
		// horLBotones
		horLBotones = buildHorLBotones();
		absLBotones.addComponent(horLBotones, "bottom:0.0px;left:0.0px;");
		
		return absLBotones;
	}

	@AutoGenerated
	private HorizontalLayout buildHorLBotones() {
		// common part: create layout
		horLBotones = new HorizontalLayout();
		horLBotones.setImmediate(false);
		horLBotones.setWidth("-1px");
		horLBotones.setHeight("-1px");
		horLBotones.setMargin(false);
		horLBotones.setSpacing(true);
		
		// btnNuevo
		btnNuevo = new Button();
		btnNuevo.setCaption("Agregar Nuevo");
		btnNuevo.setImmediate(true);
		btnNuevo.setWidth("-1px");
		btnNuevo.setHeight("-1px");
		horLBotones.addComponent(btnNuevo);
		
		// btnVolver
		btnVolver = new Button();
		btnVolver.setCaption("Volver");
		btnVolver.setImmediate(true);
		btnVolver.setWidth("-1px");
		btnVolver.setHeight("-1px");
		horLBotones.addComponent(btnVolver);
		
		return horLBotones;
	}
	
	//endregion
}