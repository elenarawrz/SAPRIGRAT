package com.saprigrat.ui;

import java.util.LinkedList;

import com.saprigrat.data.Datos;
import com.saprigrat.data.Usuario;
import com.vaadin.annotations.AutoGenerated;
import com.vaadin.event.ShortcutAction.KeyCode;
import com.vaadin.server.ThemeResource;
import com.vaadin.ui.Alignment;
import com.vaadin.ui.Button;
import com.vaadin.ui.Button.ClickEvent;
import com.vaadin.ui.Button.ClickListener;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.Embedded;
import com.vaadin.ui.HorizontalLayout;
import com.vaadin.ui.Notification;
import com.vaadin.ui.PasswordField;
import com.vaadin.ui.TextField;
import com.vaadin.ui.VerticalLayout;


@SuppressWarnings("serial")
public class LoginView extends CustomComponent
{

	/*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */

	@AutoGenerated
	private VerticalLayout mainLayout;
	@AutoGenerated
	private VerticalLayout verLFormulario;
	@AutoGenerated
	private Embedded imgLogo;
	@AutoGenerated
	private HorizontalLayout horLCredenciales;
	@AutoGenerated
	private Button btnGo;
	@AutoGenerated
	private PasswordField txtPass;
	@AutoGenerated
	private TextField txtUser;
	private Usuario usuario;
	private Datos datos;
	
	public LoginView()
	{
		buildMainLayout();
		setCompositionRoot(mainLayout);
		
		usuario = new Usuario();
		datos = new Datos();
		
		btnGo.setClickShortcut(KeyCode.ENTER);
		btnGo.addClickListener( new ClickListener()
								{
									@Override
									public void buttonClick(ClickEvent event)
									{
										if(checkPass())
										{
											mainLayout.removeAllComponents();
											mainLayout.addComponent(new MainView(usuario));
											Notification.show("Bienvenido " + usuario.getNombre(), Notification.Type.TRAY_NOTIFICATION);
										}
										else
											Notification.show("El nombre de usuario no coincide con la contraseña.", Notification.Type.WARNING_MESSAGE);
									}
								});
	}

	private boolean checkPass()
	{
		LinkedList<Object> info = datos.autenticacion(txtUser.getValue(), txtPass.getValue());
		if(!info.isEmpty())
		{
			usuario.setTipo((Integer)info.remove());
			usuario.setIdTecnico((Integer)info.remove());
			usuario.setCURR((String)info.remove());
			usuario.setNombre((String)info.remove());
			usuario.setApPaterno((String)info.remove());
			usuario.setApMaterno((String)info.remove());
			usuario.setEstado((String)info.remove());
			return true;
		}
		return false;
	}

	@AutoGenerated
	private VerticalLayout buildMainLayout() {
		// common part: create layout
		mainLayout = new VerticalLayout();
		mainLayout.setImmediate(false);
		mainLayout.setWidth("701px");
		mainLayout.setHeight("-1px");
		mainLayout.setMargin(false);
		mainLayout.setSpacing(true);
		
		// top-level component properties
		setWidth("701px");
		setHeight("-1px");
		
		// verLFormulario
		verLFormulario = buildVerLFormulario();
		mainLayout.addComponent(verLFormulario);
		mainLayout.setComponentAlignment(verLFormulario, new Alignment(20));
		
		return mainLayout;
	}

	@AutoGenerated
	private VerticalLayout buildVerLFormulario() {
		// common part: create layout
		verLFormulario = new VerticalLayout();
		verLFormulario.setImmediate(false);
		verLFormulario.setWidth("-1px");
		verLFormulario.setHeight("-1px");
		verLFormulario.setMargin(false);
		verLFormulario.setSpacing(true);
		
		// horLCredenciales
		horLCredenciales = buildHorLCredenciales();
		verLFormulario.addComponent(horLCredenciales);
		verLFormulario
				.setComponentAlignment(horLCredenciales, new Alignment(6));
		
		// imgLogo
		imgLogo = new Embedded();
		imgLogo.setImmediate(false);
		imgLogo.setWidth("700px");
		imgLogo.setHeight("-1px");
		imgLogo.setSource(new ThemeResource("img/portadav2.jpg"));
		imgLogo.setType(1);
		imgLogo.setMimeType("image/png");
		verLFormulario.addComponent(imgLogo);
		
		return verLFormulario;
	}

	@AutoGenerated
	private HorizontalLayout buildHorLCredenciales() {
		// common part: create layout
		horLCredenciales = new HorizontalLayout();
		horLCredenciales.setImmediate(false);
		horLCredenciales.setWidth("-1px");
		horLCredenciales.setHeight("-1px");
		horLCredenciales.setMargin(false);
		horLCredenciales.setSpacing(true);
		
		// txtUser
		txtUser = new TextField();
		txtUser.setCaption("Usuario");
		txtUser.setImmediate(false);
		txtUser.setWidth("150px");
		txtUser.setHeight("25px");
		horLCredenciales.addComponent(txtUser);
		
		// txtPass
		txtPass = new PasswordField();
		txtPass.setCaption("Contraseña");
		txtPass.setImmediate(false);
		txtPass.setWidth("150px");
		txtPass.setHeight("25px");
		horLCredenciales.addComponent(txtPass);
		
		// btnGo
		btnGo = new Button();
		btnGo.setCaption("Ingresar");
		btnGo.setImmediate(true);
		btnGo.setWidth("-1px");
		btnGo.setHeight("-1px");
		horLCredenciales.addComponent(btnGo);
		horLCredenciales.setComponentAlignment(btnGo, new Alignment(10));
		
		return horLCredenciales;
	}

}
