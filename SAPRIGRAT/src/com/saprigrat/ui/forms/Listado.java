package com.saprigrat.ui.forms;

import com.saprigrat.data.Datos;
import com.saprigrat.ui.interfaces.Formulario;
import com.vaadin.annotations.AutoGenerated;
import com.vaadin.data.util.filter.Compare;
import com.vaadin.data.util.sqlcontainer.SQLContainer;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.Label;
import com.vaadin.ui.Panel;
import com.vaadin.ui.Table;
import com.vaadin.ui.VerticalLayout;

@SuppressWarnings("serial")
public class Listado extends CustomComponent implements Formulario
{
	/*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */

	@AutoGenerated
	private VerticalLayout mainLayout;
	@AutoGenerated
	private Panel panResultados;
	@AutoGenerated
	private VerticalLayout verLResultados;
	@AutoGenerated
	private Table tblResultados;
	@AutoGenerated
	private Label lblResultados;
	private Datos datos;
	private int cantRestricciones;
	private String[] columnas;
	private Object[] valores;
	
	public Listado(Object[] restriccion)
	{
		inicializar();
		cantRestricciones = restriccion.length/2;
		columnas = new String[cantRestricciones];
		valores = new Object[cantRestricciones];
		setRestricciones (restriccion);
	}

	@Override
	public void inicializar()
	{
		buildMainLayout();
		setCompositionRoot(mainLayout);
		datos = new Datos();
	}

	@Override
	public void setTipo(int tipo)
	{
		String[] tablas = {"personas", "parcelas", "pozos", "aprovechamiento", "pruebaRiego"};
		String tabla = tablas[tipo];
		SQLContainer dataSource = datos.getContainer(tabla);
		for(int i=0; i<cantRestricciones; i++)
			dataSource.addContainerFilter(new Compare.Equal(columnas[i], valores[i]));
		tblResultados.setContainerDataSource(dataSource);
		lblResultados.setValue(tblResultados.size() + " Registro" + (tblResultados.size()!=1 ? "s" : ""));
	}
	
	public void setRestricciones (Object[] restriccion)
	{
		for(int i=0, j=0; j<cantRestricciones; i++, j++)
		{
			columnas[j] = (String)restriccion[i++];
			valores[j] = restriccion[i];
		}
	}

	@Override
	public int getEntidad()
	{
		return -1;
	}
	
	@Override
	public Object[] getRestricciones()
	{
		return null;
	}

	@AutoGenerated
	private VerticalLayout buildMainLayout() {
		// common part: create layout
		mainLayout = new VerticalLayout();
		mainLayout.setImmediate(false);
		mainLayout.setWidth("-1px");
		mainLayout.setHeight("-1px");
		mainLayout.setMargin(true);
		
		// top-level component properties
		setWidth("-1px");
		setHeight("-1px");
		
		// lblResultados
		lblResultados = new Label();
		lblResultados.setImmediate(false);
		lblResultados.setWidth("-1px");
		lblResultados.setHeight("-1px");
		lblResultados.setValue("0 Registros");
		mainLayout.addComponent(lblResultados);
		
		// panResultados
		panResultados = buildPanResultados();
		mainLayout.addComponent(panResultados);
		
		return mainLayout;
	}

	@AutoGenerated
	private Panel buildPanResultados() {
		// common part: create layout
		panResultados = new Panel();
		panResultados.setImmediate(false);
		panResultados.setWidth("601px");
		panResultados.setHeight("-1px");
		
		// verLResultados
		verLResultados = buildVerLResultados();
		panResultados.setContent(verLResultados);
		
		return panResultados;
	}

	@AutoGenerated
	private VerticalLayout buildVerLResultados() {
		// common part: create layout
		verLResultados = new VerticalLayout();
		verLResultados.setImmediate(false);
		verLResultados.setWidth("100.0%");
		verLResultados.setHeight("-1px");
		verLResultados.setMargin(false);
		
		// tblResultados
		tblResultados = new Table();
		tblResultados.setImmediate(false);
		tblResultados.setWidth("100.0%");
		tblResultados.setHeight("400px");
		verLResultados.addComponent(tblResultados);
		
		return verLResultados;
	}
}
